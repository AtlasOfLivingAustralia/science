


```{r}
library(galah)
library(here)
library(rmapshaper)
library(tidyverse)
library(sf)
library(ozmaps)
library(tidyr)
```

You can put the CAPAD folder in the projects/dingo/data folder and this will run

here()
here::here("/Users/smi9e9/Documents/tutorials")

```{r}
capad <- st_read(here("/Users",
                      "smi9e9",
                      "Documents",
                      "tutorials",                     
                      "CAPAD",
                      "CAPAD2020_terrestrial.shp"),
                 quiet = TRUE) |>
  ms_simplify(keep = 0.1)
```

```{r}
summary(capad)
view(capad_counts)
```

```{r}
capad <- capad |>
  st_transform(crs = st_crs("WGS84")) |>
  st_make_valid()
```


**Looks like there are national reserves outside of mainland australia that are mapped**

```{r}
capad_filtered <- capad %>%
  filter(LONGITUDE > 155 | LONGITUDE < 110 | LATITUDE < -45 | LATITUDE > -10)
```

```{r}
#capad_NT <- capad %>%
#  filter(capad_filtered$NAME %in% NAME)
```



```{r}
install.packages("prismatic")
ggdevtools::install_github("EmilHvitfeldt/prismatic")
remotes::install_github("wilkelab/cowplot")
install.packages("colorspace", repos = "http://R-Forge.R-project.org")
remotes::install_github("clauswilke/colorblindr")
```

```{r}
library(prismatic)
library(magrittr)
library(colorblindr)
```

```{r}
terrain10 <- terrain.colors(10)

terrain10
#>  [1] "#00A600" "#2DB600" "#63C600" "#A0D600" "#E6E600" "#E8C32E" "#EBB25E"
#>  [8] "#EDB48E" "#F0C9C0" "#F2F2F2"

terrain_color <- color(terrain10)

terrain_color
#> <colors>
#> #00A600FF #2DB600FF #63C600FF #A0D600FF #E6E600FF #E8C32EFF #EBB25EFF #EDB48EFF #F0C9C0FF #F2F2F2FF

plot(terrain_color)
```
```{r}
color(rainbow(64))
```


Let's filter the coordinates to narrow our map to within mainland australia

```{r}
ggplot() +
  geom_sf(data = ozmap_states, 
          fill = "beige", colour = "black", linewidth = 0.3) +
  geom_sf(data = capad, fill = "#00A600FF", colour = "black", linewidth = 0.25, alpha = 0.5) +
  geom_sf(data = dingo_sf, 
               colour = '#0070FFFF', size = 1.5
                             , alpha = 0.25) +
  coord_sf(xlim = c(128, 140), ylim = c(-10, -26)) + # filter to mainland australia
  theme_bw() +
  theme(axis.text.x=element_text(angle = -90, hjust = 0), 
        panel.background = element_rect(fill = "white", size = 2), 
        panel.grid.major = element_line(colour = NA),
        plot.title = element_text(face = "bold", size = 16, hjust = 0.5),
        axis.ticks = element_line(colour = "grey70", size = 0.2),
        axis.title.y = element_text(size = 12),
        axis.title.x = element_text(size = 12)) +
  labs(title = "Dingo observations in Australian Protected Areas in the Northern Territory (NT)", x = "Longitude", y = "Latitude") 
  

  
```

```{r}
galah_config(email = "SMI9E9@csiro.au", verbose = FALSE)
```

```{r}
dingoocc <- galah_call() |>
  galah_identify("canis familiaris") |>
  galah_filter(raw_vernacularName == "Dingo") |>
  galah_apply_profile(ALA) |>
  galah_group_by(dataResourceName) |>
  atlas_occurrences()
```

This is a simpler way to prepare the points for plotting if you want to plot using `geom_sf()`**

```{r}
# convert occurrence points to `sf` object, drop records without lat or lon coords, add projection
dingo_sf <- dingoocc |> 
  drop_na(decimalLongitude, decimalLatitude) |>
  st_as_sf(coords = c("decimalLongitude", "decimalLatitude"), 
           crs = st_crs("WGS84"))
```


From this point, you should have everything you need to make the map**
- I think it would be nice to have a white map of australia underneath the CAPAD layer. You can get this from the {ozmaps} package
- Then you can plot the dingo observations points on the map. Using `alpha` could help make it easier to see which points are in the national parks
- Decide whether looking at all of Australia is too difficult to see the points and the national parks. Maybe it would be better to filter the map to only show one state at a time? I think you should be able to do that with the code that is here :)


```{r}

capad_counts <- capad |> 
  mutate(dingo_count = pmap(.l = list(x = capad$geometry),
                           .f = function(x) {
                             lengths(st_intersects(x, dingo_sf))
                             }))
```

```{r}
dingoNT <- capad_counts |> select(STATE, dingo_count, NAME) |>
  filter(STATE == "NT")
```

```{r}
hist(as.numeric(capad_counts$dingo_count))
```

```{r}
dingoNT |>
  arrange(desc(dingo_count)) 
#still need to get this to work

view(dingoNT)
```


```{r}
library(glue)
```

```{r}
dingo_palette <- list("Australian Protected Areas" = "#00A600FF",
                      "Dingo observations" = " viridis::scale_color_viridis")
```

```{r}
galah_config(email = "SMI9E9@csiro.au")

dingo_records <- galah_call() |>
  galah_identify("canis familiaris") |>
  galah_filter(raw_vernacularName == "Dingo")|>
  # galah_filter(cl22 == "NT")
  atlas_occurrences()
```


```{r}
# Tidy
dingo_records <- dingo_records |>
  drop_na() |>                      # drop NAs
  filter(decimalLongitude < 155,    # filter records to only mainland/tasmania
         decimalLongitude > 110, 
         decimalLatitude > -45,
         decimalLatitude < -10)
```



I'm also unsure of how to get the records just in the NT, I have tried the group by function and filter but doesnt seem to work f

This is the point density one which I prefer more. 

```{r}
ggplot() +
  geom_sf(data = ozmap_states, 
          fill = "beige", colour = "black", linewidth = 0.3) +
  geom_sf(data = capad, fill = "#00A600FF", colour = "black", linewidth = 0.25, alpha = 0.5) +
  geom_pointdensity(data = dingo_records, 
                    mapping = aes(x = decimalLongitude,
                                  y = decimalLatitude)) +
    viridis::scale_color_viridis(option = "F", 
                               begin = 0.1,
                               guide_colorbar(direction = "horizontal")) +
  guides(colour = guide_colourbar(
    title = "Number of \nOverlapping observations"), 
    alpha = "none",
    label.position = "right") +
  coord_sf(xlim = c(128, 140), ylim = c(-10, -26)) + # filter to mainland australia
#  theme_bw() +
  theme(axis.text.x=element_text(angle = -90, hjust = 0), 
        panel.background = element_rect(fill = "white", size = 2), 
        panel.grid.major = element_line(colour = NA),
        plot.title = element_text(face = "bold", size = 16, hjust = 0.5),
        axis.ticks = element_line(colour = "grey70", size = 0.2),
        axis.title.y = element_text(size = 12),
        axis.title.x = element_text(size = 12)) +
        labs(title = glue("<br> <span style = 'color: {Dingo_palette$Dingo obsverations}'> **Dingo Observations</span> in <br>
                    <span style = 'color: {dingo_palette$Australian Protected Areas}'>
                    **Australian Protected Areas</span> in the Northern Territory (NT)", x = "Longitude", y = "Latitude"))
```





